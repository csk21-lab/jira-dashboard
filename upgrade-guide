# Elasticsearch Upgrade Guide: 7.10.2 → 8.13.4 on RHEL (RPM-based)

---

## ✅ 1. Pre-Upgrade Checklist

```bash
# Check current Elasticsearch version
curl -X GET "http://localhost:9200"

# List installed plugins
/usr/share/elasticsearch/bin/elasticsearch-plugin list
```
_Save plugin list for reinstallation after upgrade._

---

## ✅ 2. Take Backup Using Snapshot API

```bash
# Create snapshot repository
curl -X PUT "localhost:9200/_snapshot/my_backup_repo" -H 'Content-Type: application/json' -d '
{
  "type": "fs",
  "settings": {
    "location": "/mnt/backups/es_snapshots"
  }
}'

# Create snapshot
curl -X PUT "localhost:9200/_snapshot/my_backup_repo/pre_upgrade_snapshot?wait_for_completion=true"
```

---

## ✅ 3. Stop Elasticsearch Service

```bash
sudo systemctl stop elasticsearch
```

---

## ✅ 4. Download Elasticsearch 8.13.4 RPM

```bash
cd /tmp
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.13.4-x86_64.rpm
```

---

## ✅ 5. Install New Version (RPM)

```bash
sudo rpm -ivh --replacepkgs elasticsearch-8.13.4-x86_64.rpm
```
> **Note:** Do not use `yum update`, as it may overwrite custom config files.

---

## ✅ 6. Preserve and Update Configuration Files

```bash
cp /etc/elasticsearch/elasticsearch.yml /etc/elasticsearch/elasticsearch.yml.bak
cp /etc/elasticsearch/jvm.options /etc/elasticsearch/jvm.options.bak
```
_Optional (for testing only): Disable security by editing `elasticsearch.yml`_

```yaml
xpack.security.enabled: false
xpack.security.http.ssl.enabled: false
```

---

## ✅ 7. Reinstall Plugins (if any)

_Reinstall previously listed plugins:_

```bash
sudo /usr/share/elasticsearch/bin/elasticsearch-plugin install <plugin-name>
```
**Example:**

```bash
sudo /usr/share/elasticsearch/bin/elasticsearch-plugin install analysis-icu
```

---

## ✅ 8. Start Elasticsearch

```bash
sudo systemctl start elasticsearch
```

---

## ✅ 9. Verify Upgrade

```bash
curl -X GET "http://localhost:9200"
```
_Expected output:_

```json
"version": {
  "number": "8.13.4"
}
```

_Check logs:_

```bash
tail -f /var/log/elasticsearch/elasticsearch.log
```

---

## ✅ 10. Post-Upgrade Tasks

_Reindex old indices (from 6.x or early 7.x) if needed:_

```bash
curl -X POST "localhost:9200/_reindex" -H 'Content-Type: application/json' -d '
{
  "source": { "index": "old_index" },
  "dest": { "index": "new_index" }
}'
```

_Re-enable security and TLS (for production use)._

---

## ✅ References

- [Upgrade Guide](https://www.elastic.co/guide/en/elasticsearch/reference/8.13/setup-upgrade.html)
- [Breaking Changes](https://www.elastic.co/guide/en/elasticsearch/reference/8.13/breaking-changes-8.0.html)
- [RPM Install](https://www.elastic.co/guide/en/elasticsearch/reference/8.13/rpm.html)

---

Let me know if you'd like this formatted into a downloadable PDF or need additional help!